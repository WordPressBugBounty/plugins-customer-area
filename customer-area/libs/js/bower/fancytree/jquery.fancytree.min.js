!function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree.ui-deps"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree.ui-deps"),module.exports=e(require("jquery"))):e(jQuery)}(function(k){"use strict";if(!k.ui||!k.ui.fancytree){for(var e,u=null,d=new RegExp(/\.|\//),t=/[&<>"'/]/g,n=/[<>"'/]/g,c="$recursive_request",i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},r={16:!0,17:!0,18:!0},h={8:"backspace",9:"tab",10:"return",13:"return",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},f={16:"shift",17:"ctrl",18:"alt",91:"meta",93:"meta"},o={0:"",1:"left",2:"middle",3:"right"},v="active expanded focus folder lazy radiogroup selected unselectable unselectableIgnore".split(" "),y={},p="columns types".split(" "),b="checkbox expanded extraClasses folder icon iconTooltip key lazy partsel radiogroup refKey selected statusNodeType title tooltip type unselectable unselectableIgnore unselectableStatus".split(" "),a={},m={},s={active:!0,children:!0,data:!0,focus:!0},l=0;l<v.length;l++)y[v[l]]=!0;for(l=0;l<b.length;l++)e=b[l],a[e]=!0,e!==e.toLowerCase()&&(m[e.toLowerCase()]=e);return _(k.ui,"Fancytree requires jQuery UI (http://jqueryui.com)"),Date.now||(Date.now=function(){return(new Date).getTime()}),L.prototype={_findDirectChild:function(e){var t,n,i=this.children;if(i)if("string"==typeof e){for(t=0,n=i.length;t<n;t++)if(i[t].key===e)return i[t]}else{if("number"==typeof e)return this.children[e];if(e.parent===this)return e}return null},_setChildren:function(e){_(e&&(!this.children||0===this.children.length),"only init supported"),this.children=[];for(var t=0,n=e.length;t<n;t++)this.children.push(new L(this,e[t]));this.tree._callHook("treeStructureChanged",this.tree,"setChildren")},addChildren:function(e,t){var n,i,r,o,a=this.getFirstChild(),s=this.getLastChild(),l=[];for(k.isPlainObject(e)&&(e=[e]),this.children||(this.children=[]),n=0,i=e.length;n<i;n++)l.push(new L(this,e[n]));if(o=l[0],null==t?this.children=this.children.concat(l):(t=this._findDirectChild(t),_(0<=(r=k.inArray(t,this.children)),"insertBefore must be an existing child"),this.children.splice.apply(this.children,[r,0].concat(l))),a&&!t){for(n=0,i=l.length;n<i;n++)l[n].render();a!==this.getFirstChild()&&a.renderStatus(),s!==this.getLastChild()&&s.renderStatus()}else this.parent&&!this.parent.ul&&!this.tr||this.render();return 3===this.tree.options.selectMode&&this.fixSelection3FromEndNodes(),this.triggerModifyChild("add",1===l.length?l[0]:null),o},addClass:function(e){return this.toggleClass(e,!0)},addNode:function(e,t){switch(t=void 0!==t&&"over"!==t?t:"child"){case"after":return this.getParent().addChildren(e,this.getNextSibling());case"before":return this.getParent().addChildren(e,this);case"firstChild":var n=this.children?this.children[0]:null;return this.addChildren(e,n);case"child":case"over":return this.addChildren(e)}_(!1,"Invalid mode: "+t)},addPagingNode:function(e,t){var n,i;if(t=t||"child",!1!==e)return e=k.extend({title:this.tree.options.strings.moreData,statusNodeType:"paging",icon:!1},e),this.partload=!0,this.addNode(e,t);for(n=this.children.length-1;0<=n;n--)"paging"===(i=this.children[n]).statusNodeType&&this.removeChild(i);this.partload=!1},appendSibling:function(e){return this.addNode(e,"after")},applyCommand:function(e,t){return this.tree.applyCommand(e,this,t)},applyPatch:function(e){if(null===e)return this.remove(),N(this);var t,n,i={children:!0,expanded:!0,parent:!0};for(t in e)e.hasOwnProperty(t)&&(n=e[t],i[t]||k.isFunction(n)||(a[t]?this[t]=n:this.data[t]=n));return e.hasOwnProperty("children")&&(this.removeChildren(),e.children)&&this._setChildren(e.children),this.isVisible()&&(this.renderTitle(),this.renderStatus()),e.hasOwnProperty("expanded")?this.setExpanded(e.expanded):N(this)},collapseSiblings:function(){return this.tree._callHook("nodeCollapseSiblings",this)},copyTo:function(e,t,n){return e.addNode(this.toDict(!0,n),t)},countChildren:function(e){var t,n,i,r=this.children;if(!r)return 0;if(i=r.length,!1!==e)for(t=0,n=i;t<n;t++)i+=r[t].countChildren();return i},debug:function(e){4<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),g("log",arguments))},discard:function(){return this.warn("FancytreeNode.discard() is deprecated since 2014-02-16. Use .resetLazy() instead."),this.resetLazy()},discardMarkup:function(e){this.tree._callHook(e?"nodeRemoveMarkup":"nodeRemoveChildMarkup",this)},error:function(e){1<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),g("error",arguments))},findAll:function(t){t=k.isFunction(t)?t:T(t);var n=[];return this.visit(function(e){t(e)&&n.push(e)}),n},findFirst:function(t){t=k.isFunction(t)?t:T(t);var n=null;return this.visit(function(e){if(t(e))return n=e,!1}),n},findRelatedNode:function(e,t){return this.tree.findRelatedNode(this,e,t)},_changeSelectStatusAttrs:function(e){var t=!1,n=this.tree.options,i=u.evalOption("unselectable",this,this,n,!1),n=u.evalOption("unselectableStatus",this,this,n,void 0);switch(e=i&&null!=n?n:e){case!1:t=this.selected||this.partsel,this.selected=!1,this.partsel=!1;break;case!0:t=!this.selected||!this.partsel,this.selected=!0,this.partsel=!0;break;case void 0:t=this.selected||!this.partsel,this.selected=!1,this.partsel=!0;break;default:_(!1,"invalid state: "+e)}return t&&this.renderStatus(),t},fixSelection3AfterClick:function(e){var t=this.isSelected();this.visit(function(e){if(e._changeSelectStatusAttrs(t),e.radiogroup)return"skip"}),this.fixSelection3FromEndNodes(e)},fixSelection3FromEndNodes:function(e){var h=this.tree.options;_(3===h.selectMode,"expected selectMode 3"),function e(t){var n,i,r,o,a,s,l,d,c=t.children;if(c&&c.length){for(l=!(s=!0),n=0,i=c.length;n<i;n++)o=e(r=c[n]),u.evalOption("unselectableIgnore",r,r,h,!1)||(!1!==o&&(l=!0),!0!==o&&(s=!1));a=!!s||!!l&&void 0}else a=null==(d=u.evalOption("unselectableStatus",t,t,h,void 0))?!!t.selected:!!d;return t.partsel&&!t.selected&&t.lazy&&null==t.children&&(a=void 0),t._changeSelectStatusAttrs(a),a}(this),this.visitParents(function(e){for(var t,n,i,r=e.children,o=!0,a=!1,s=0,l=r.length;s<l;s++)t=r[s],u.evalOption("unselectableIgnore",t,t,h,!1)||(((n=null==(i=u.evalOption("unselectableStatus",t,t,h,void 0))?!!t.selected:!!i)||t.partsel)&&(a=!0),n)||(o=!1);e._changeSelectStatusAttrs(n=!!o||!!a&&void 0)})},fromDict:function(e){for(var t in e)a[t]?this[t]=e[t]:"data"===t?k.extend(this.data,e.data):k.isFunction(e[t])||s[t]||(this.data[t]=e[t]);e.children&&(this.removeChildren(),this.addChildren(e.children)),this.renderTitle()},getChildren:function(){if(void 0!==this.hasChildren())return this.children},getFirstChild:function(){return this.children?this.children[0]:null},getIndex:function(){return k.inArray(this,this.parent.children)},getIndexHier:function(e,n){e=e||".";var i,r=[];return k.each(this.getParentList(!1,!0),function(e,t){i=""+(t.getIndex()+1),n&&(i=("0000000"+i).substr(-n)),r.push(i)}),r.join(e)},getKeyPath:function(e){var t=this.tree.options.keyPathSeparator;return t+this.getPath(!e,"key",t)},getLastChild:function(){return this.children?this.children[this.children.length-1]:null},getLevel:function(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e},getNextSibling:function(){if(this.parent)for(var e=this.parent.children,t=0,n=e.length-1;t<n;t++)if(e[t]===this)return e[t+1];return null},getParent:function(){return this.parent},getParentList:function(e,t){for(var n=[],i=t?this:this.parent;i;)(e||i.parent)&&n.unshift(i),i=i.parent;return n},getPath:function(e,t,n){e=!1!==e,t=t||"title",n=n||"/";var i,r=[],o=k.isFunction(t);return this.visitParents(function(e){e.parent&&(i=o?t(e):e[t],r.unshift(i))},e),r.join(n)},getPrevSibling:function(){if(this.parent)for(var e=this.parent.children,t=1,n=e.length;t<n;t++)if(e[t]===this)return e[t-1];return null},getSelectedNodes:function(t){var n=[];return this.visit(function(e){if(e.selected&&(n.push(e),!0===t))return"skip"}),n},hasChildren:function(){return this.lazy?null==this.children?void 0:0!==this.children.length&&(1!==this.children.length||!this.children[0].isStatusNode()||void 0):!(!this.children||!this.children.length)},hasClass:function(e){return 0<=(" "+(this.extraClasses||"")+" ").indexOf(" "+e+" ")},hasFocus:function(){return this.tree.hasFocus()&&this.tree.focusNode===this},info:function(e){3<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),g("info",arguments))},isActive:function(){return this.tree.activeNode===this},isBelowOf:function(e){return this.getIndexHier(".",5)>e.getIndexHier(".",5)},isChildOf:function(e){return this.parent&&this.parent===e},isDescendantOf:function(e){if(e&&e.tree===this.tree)for(var t=this.parent;t;){if(t===e)return!0;t===t.parent&&k.error("Recursive parent link: "+t),t=t.parent}return!1},isExpanded:function(){return!!this.expanded},isFirstSibling:function(){var e=this.parent;return!e||e.children[0]===this},isFolder:function(){return!!this.folder},isLastSibling:function(){var e=this.parent;return!e||e.children[e.children.length-1]===this},isLazy:function(){return!!this.lazy},isLoaded:function(){return!this.lazy||void 0!==this.hasChildren()},isLoading:function(){return!!this._isLoading},isRoot:function(){return this.isRootNode()},isPartsel:function(){return!this.selected&&!!this.partsel},isPartload:function(){return!!this.partload},isRootNode:function(){return this.tree.rootNode===this},isSelected:function(){return!!this.selected},isStatusNode:function(){return!!this.statusNodeType},isPagingNode:function(){return"paging"===this.statusNodeType},isTopLevel:function(){return this.tree.rootNode===this.parent},isUndefined:function(){return void 0===this.hasChildren()},isVisible:function(){var e,t,n=this.tree.enableFilter,i=this.getParentList(!1,!1);if(n&&!this.match&&!this.subMatchCount)return!1;for(e=0,t=i.length;e<t;e++)if(!i[e].expanded)return!1;return!0},lazyLoad:function(e){return this.warn("FancytreeNode.lazyLoad() is deprecated since 2014-02-16. Use .load() instead."),this.load(e)},load:function(e){var t=this,n=this.isExpanded();return _(this.isLazy(),"load() requires a lazy node"),!e&&!this.isUndefined()||(this.isLoaded()&&this.resetLazy(),!1===(e=this.tree._triggerNodeEvent("lazyLoad",this)))?N(this):(_("boolean"!=typeof e,"lazyLoad event must return source in data.result"),e=this.tree._callHook("nodeLoadChildren",this,e),n?(this.expanded=!0,e.always(function(){t.render()})):e.always(function(){t.renderStatus()}),e)},makeVisible:function(e){for(var t=this,n=[],i=new k.Deferred,r=this.getParentList(!1,!1),o=r.length,a=!(e&&!0===e.noAnimation),s=!(e&&!1===e.scrollIntoView),l=o-1;0<=l;l--)n.push(r[l].setExpanded(!0,e));return k.when.apply(k,n).done(function(){s?t.scrollIntoView(a).done(function(){i.resolve()}):i.resolve()}),i.promise()},moveTo:function(t,e,n){void 0===e||"over"===e?e="child":"firstChild"===e&&(t.children&&t.children.length?(e="before",t=t.children[0]):e="child");var i,r=this.tree,o=this.parent,a="child"===e?t:t.parent;if(this!==t){if(this.parent?a.isDescendantOf(this)&&k.error("Cannot move a node to its own descendant"):k.error("Cannot move system root"),a!==o&&o.triggerModifyChild("remove",this),1===this.parent.children.length){if(this.parent===a)return;this.parent.children=this.parent.lazy?[]:null,this.parent.expanded=!1}else _(0<=(i=k.inArray(this,this.parent.children)),"invalid source parent"),this.parent.children.splice(i,1);if((this.parent=a).hasChildren())switch(e){case"child":a.children.push(this);break;case"before":_(0<=(i=k.inArray(t,a.children)),"invalid target parent"),a.children.splice(i,0,this);break;case"after":_(0<=(i=k.inArray(t,a.children)),"invalid target parent"),a.children.splice(i+1,0,this);break;default:k.error("Invalid mode "+e)}else a.children=[this];n&&t.visit(n,!0),a===o?a.triggerModifyChild("move",this):a.triggerModifyChild("add",this),r!==t.tree&&(this.warn("Cross-tree moveTo is experimental!"),this.visit(function(e){e.tree=t.tree},!0)),r._callHook("treeStructureChanged",r,"moveTo"),o.isDescendantOf(a)||o.render(),a.isDescendantOf(o)||a===o||a.render()}},navigate:function(e,t){var n=k.ui.keyCode;switch(e){case"left":case n.LEFT:if(this.expanded)return this.setExpanded(!1);break;case"right":case n.RIGHT:if(!this.expanded&&(this.children||this.lazy))return this.setExpanded()}if(n=this.findRelatedNode(e)){try{n.makeVisible({scrollIntoView:!1})}catch(e){}return!1===t?(n.setFocus(),N()):n.setActive()}return this.warn("Could not find related node '"+e+"'."),N()},remove:function(){return this.parent.removeChild(this)},removeChild:function(e){return this.tree._callHook("nodeRemoveChild",this,e)},removeChildren:function(){return this.tree._callHook("nodeRemoveChildren",this)},removeClass:function(e){return this.toggleClass(e,!1)},render:function(e,t){return this.tree._callHook("nodeRender",this,e,t)},renderTitle:function(){return this.tree._callHook("nodeRenderTitle",this)},renderStatus:function(){return this.tree._callHook("nodeRenderStatus",this)},replaceWith:function(e){var n=this.parent,i=k.inArray(this,n.children),r=this;return _(this.isPagingNode(),"replaceWith() currently requires a paging status node"),(e=this.tree._callHook("nodeLoadChildren",this,e)).done(function(e){var t=r.children;for(l=0;l<t.length;l++)t[l].parent=n;n.children.splice.apply(n.children,[i+1,0].concat(t)),r.children=null,r.remove(),n.render()}).fail(function(){r.setExpanded()}),e},resetLazy:function(){this.removeChildren(),this.expanded=!1,this.lazy=!0,this.children=void 0,this.renderStatus()},scheduleAction:function(e,t){this.tree.timer&&(clearTimeout(this.tree.timer),this.tree.debug("clearTimeout(%o)",this.tree.timer)),this.tree.timer=null;var n=this;switch(e){case"cancel":break;case"expand":this.tree.timer=setTimeout(function(){n.tree.debug("setTimeout: trigger expand"),n.setExpanded(!0)},t);break;case"activate":this.tree.timer=setTimeout(function(){n.tree.debug("setTimeout: trigger activate"),n.setActive(!0)},t);break;default:k.error("Invalid mode "+e)}},scrollIntoView:function(e,t){if(void 0!==t&&t.tree&&void 0!==t.statusNodeType)throw Error("scrollIntoView() with 'topNode' option is deprecated since 2014-05-08. Use 'options.topNode' instead.");var e=k.extend({effects:!0===e?{duration:200,queue:!1}:e,scrollOfs:this.tree.options.scrollOfs,scrollParent:this.tree.options.scrollParent,topNode:null},t),t=e.scrollParent,n=this.tree.$container,i=n.css("overflow-y");t?t.jquery||(t=k(t)):t=!this.tree.tbody&&("scroll"===i||"auto"===i)?n:n.scrollParent(),t[0]!==document&&t[0]!==document.body||(this.debug("scrollIntoView(): normalizing scrollParent to 'window':",t[0]),t=k(window));var r,o,a=new k.Deferred,s=this,i=k(this.span).height(),n=e.scrollOfs.top||0,l=e.scrollOfs.bottom||0,d=t.height(),c=t.scrollTop(),h=t,u=t[0]===window,f=e.topNode||null,p=null;return this.isVisible()?(u?(o=k(this.span).offset().top,r=f&&f.span?k(f.span).offset().top:0,h=k("html,body")):(_(t[0]!==document&&t[0]!==document.body,"scrollParent should be a simple element or `window`, not document or body."),u=t.offset().top,o=k(this.span).offset().top-u+c,r=f?k(f.span).offset().top-u+c:0,d-=Math.max(0,t.innerHeight()-t[0].clientHeight)),o<c+n?p=o-n:c+d-l<o+i&&(p=o+i-d+l,f)&&(_(f.isRootNode()||f.isVisible(),"topNode must be visible"),r<p)&&(p=r-n),null===p?a.resolveWith(this):e.effects?(e.effects.complete=function(){a.resolveWith(s)},h.stop(!0).animate({scrollTop:p},e.effects)):(h[0].scrollTop=p,a.resolveWith(this)),a.promise()):(this.warn("scrollIntoView(): node is invisible."),N())},setActive:function(e,t){return this.tree._callHook("nodeSetActive",this,e,t)},setExpanded:function(e,t){return this.tree._callHook("nodeSetExpanded",this,e,t)},setFocus:function(e){return this.tree._callHook("nodeSetFocus",this,e)},setSelected:function(e,t){return this.tree._callHook("nodeSetSelected",this,e,t)},setStatus:function(e,t,n){return this.tree._callHook("nodeSetStatus",this,e,t,n)},setTitle:function(e){this.title=e,this.renderTitle(),this.triggerModify("rename")},sortChildren:function(e,t){var n,i,r=this.children;if(r){if(r.sort(e=e||function(e,t){e=e.title.toLowerCase(),t=t.title.toLowerCase();return e===t?0:t<e?1:-1}),t)for(n=0,i=r.length;n<i;n++)r[n].children&&r[n].sortChildren(e,"$norender$");"$norender$"!==t&&this.render(),this.triggerModifyChild("sort")}},toDict:function(e,t){var n,i,r,o,a={},s=this;if(k.each(b,function(e,t){!s[t]&&!1!==s[t]||(a[t]=s[t])}),k.isEmptyObject(this.data)||(a.data=k.extend({},this.data),k.isEmptyObject(a.data)&&delete a.data),t){if(!1===(o=t(a,s)))return!1;"skip"===o&&(e=!1)}if(e&&this.hasChildren())for(a.children=[],n=0,i=this.children.length;n<i;n++)(r=this.children[n]).isStatusNode()||!1!==(o=r.toDict(!0,t))&&a.children.push(o);return a},toggleClass:function(e,t){var n,i,r=e.match(/\S+/g)||[],o=0,a=!1,s=this[this.tree.statusClassPropName],l=" "+(this.extraClasses||"")+" ";for(s&&k(s).toggleClass(e,t);n=r[o++];)if(i=0<=l.indexOf(" "+n+" "),t=void 0===t?!i:!!t)i||(l+=n+" ",a=!0);else for(;-1<l.indexOf(" "+n+" ");)l=l.replace(" "+n+" "," ");return this.extraClasses=k.trim(l),a},toggleExpanded:function(){return this.tree._callHook("nodeToggleExpanded",this)},toggleSelected:function(){return this.tree._callHook("nodeToggleSelected",this)},toString:function(){return"FancytreeNode@"+this.key+"[title='"+this.title+"']"},triggerModifyChild:function(e,t,n){var i=this.tree.options.modifyChild;i&&(t&&t.parent!==this&&k.error("childNode "+t+" is not a child of "+this),e={node:this,tree:this.tree,operation:e,childNode:t||null},n&&k.extend(e,n),i({type:"modifyChild"},e))},triggerModify:function(e,t){this.parent.triggerModifyChild(e,this,t)},visit:function(e,t){var n,i,r=!0,o=this.children;if((!0!==t||!1!==(r=e(this))&&"skip"!==r)&&o)for(n=0,i=o.length;n<i&&!1!==(r=o[n].visit(e,!0));n++);return r},visitAndLoad:function(n,e,t){var i,r,o,a=this;return!n||!0!==e||!1!==(r=n(a))&&"skip"!==r?a.children||a.lazy?(i=new k.Deferred,o=[],a.load().done(function(){for(var e=0,t=a.children.length;e<t;e++){if(!1===(r=a.children[e].visitAndLoad(n,!0,!0))){i.reject();break}"skip"!==r&&o.push(r)}k.when.apply(this,o).then(function(){i.resolve()})}),i.promise()):N():t?r:N()},visitParents:function(e,t){if(t&&!1===e(this))return!1;for(var n=this.parent;n;){if(!1===e(n))return!1;n=n.parent}return!0},visitSiblings:function(e,t){for(var n,i=this.parent.children,r=0,o=i.length;r<o;r++)if(n=i[r],(t||n!==this)&&!1===e(n))return!1;return!0},warn:function(e){2<=this.tree.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),g("warn",arguments))}},k.extend(A.prototype={_makeHookContext:function(e,t,n){var i,r;return void 0!==e.node?(t&&e.originalEvent!==t&&k.error("invalid args"),i=e):e.tree?i={node:e,tree:r=e.tree,widget:r.widget,options:r.widget.options,originalEvent:t,typeInfo:r.types[e.type]||{}}:e.widget?i={node:null,tree:e,widget:e.widget,options:e.widget.options,originalEvent:t}:k.error("invalid args"),n&&k.extend(i,n),i},_callHook:function(e,t,n){var t=this._makeHookContext(t),i=this[e],r=Array.prototype.slice.call(arguments,2);return k.isFunction(i)||k.error("_callHook('"+e+"') is not a function"),r.unshift(t),i.apply(this,r)},_setExpiringValue:function(e,t,n){this._tempCache[e]={value:t,expire:Date.now()+(+n||50)}},_getExpiringValue:function(e){var t=this._tempCache[e];return t&&t.expire>Date.now()?t.value:(delete this._tempCache[e],null)},_requireExtension:function(e,t,n,i){null!=n&&(n=!!n);var r=this._local.name,o=this.options.extensions,o=k.inArray(e,o)<k.inArray(r,o),a=t&&null==this.ext[e],o=!a&&null!=n&&n!==o;return _(r&&r!==e,"invalid or same name '"+r+"' (require yourself?)"),!a&&!o||(i||(a||t?(i="'"+r+"' extension requires '"+e+"'",o&&(i+=" to be registered "+(n?"before":"after")+" itself")):i="If used together, `"+e+"` must be registered "+(n?"before":"after")+" `"+r+"`"),k.error(i),!1)},activateKey:function(e,t){e=this.getNodeByKey(e);return e?e.setActive(!0,t):this.activeNode&&this.activeNode.setActive(!1,t),e},addPagingNode:function(e,t){return this.rootNode.addPagingNode(e,t)},applyCommand:function(e,t,n){var i;switch(t=t||this.getActiveNode(),e){case"moveUp":(i=t.getPrevSibling())&&(t.moveTo(i,"before"),t.setActive());break;case"moveDown":(i=t.getNextSibling())&&(t.moveTo(i,"after"),t.setActive());break;case"indent":(i=t.getPrevSibling())&&(t.moveTo(i,"child"),i.setExpanded(),t.setActive());break;case"outdent":t.isTopLevel()||(t.moveTo(t.getParent(),"after"),t.setActive());break;case"remove":i=t.getPrevSibling()||t.getParent(),t.remove(),i&&i.setActive();break;case"addChild":t.editCreateNode("child","");break;case"addSibling":t.editCreateNode("after","");break;case"rename":t.editStart();break;case"down":case"first":case"last":case"left":case"parent":case"right":case"up":return t.navigate(e);default:k.error("Unhandled command: '"+e+"'")}},applyPatch:function(e){for(var t,n,i,r,o=e.length,a=[],s=0;s<o;s++)_(2===(i=e[s]).length,"patchList must be an array of length-2-arrays"),n=i[0],i=i[1],(r=null===n?this.rootNode:this.getNodeByKey(n))?(t=new k.Deferred,a.push(t),r.applyPatch(i).always(w(t,r))):this.warn("could not find node with key '"+n+"'");return k.when.apply(k,a).promise()},clear:function(e){this._callHook("treeClear",this)},count:function(){return this.rootNode.countChildren()},debug:function(e){4<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),g("log",arguments))},enable:function(e){!1===e?this.widget.disable():this.widget.enable()},enableUpdate:function(e){return!!this._enableUpdate==!!(e=!1!==e)?e:((this._enableUpdate=e)?(this.debug("enableUpdate(true): redraw "),this._callHook("treeStructureChanged",this,"enableUpdate"),this.render()):this.debug("enableUpdate(false)..."),!e)},error:function(e){1<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),g("error",arguments))},expandAll:function(t,n){var e=this.enableUpdate(!1);t=!1!==t,this.visit(function(e){!1!==e.hasChildren()&&e.isExpanded()!==t&&e.setExpanded(t,n)}),this.enableUpdate(e)},findAll:function(e){return this.rootNode.findAll(e)},findFirst:function(e){return this.rootNode.findFirst(e)},findNextNode:function(t,n){var i,r=null,e=this.getFirstChild();function o(e){if((r=t(e)?e:r)||e===n)return!1}return t="string"==typeof t?(i=new RegExp("^"+t,"i"),function(e){return i.test(e.title)}):t,n=n||e,this.visitRows(o,{start:n,includeSelf:!1}),r||n===e||this.visitRows(o,{start:e,includeSelf:!0}),r},findRelatedNode:function(e,t,n){var i=null,r=k.ui.keyCode;switch(t){case"parent":case r.BACKSPACE:e.parent&&e.parent.parent&&(i=e.parent);break;case"first":case r.HOME:this.visit(function(e){if(e.isVisible())return i=e,!1});break;case"last":case r.END:this.visit(function(e){e.isVisible()&&(i=e)});break;case"left":case r.LEFT:e.expanded?e.setExpanded(!1):e.parent&&e.parent.parent&&(i=e.parent);break;case"right":case r.RIGHT:e.expanded||!e.children&&!e.lazy?e.children&&e.children.length&&(i=e.children[0]):(e.setExpanded(),i=e);break;case"up":case r.UP:this.visitRows(function(e){return i=e,!1},{start:e,reverse:!0,includeSelf:!1});break;case"down":case r.DOWN:this.visitRows(function(e){return i=e,!1},{start:e,includeSelf:!1});break;default:this.tree.warn("Unknown relation '"+t+"'.")}return i},generateFormElements:function(e,t,n){n=n||{};var i="string"==typeof e?e:"ft_"+this._id+"[]",r="string"==typeof t?t:"ft_"+this._id+"_active",o="fancytree_result_"+this._id,a=k("#"+o),s=3===this.options.selectMode&&!1!==n.stopOnParents;function l(e){a.append(k("<input>",{type:"checkbox",name:i,value:e.key,checked:!0}))}a.length?a.empty():a=k("<div>",{id:o}).hide().insertAfter(this.$container),!1!==t&&this.activeNode&&a.append(k("<input>",{type:"radio",name:r,value:this.activeNode.key,checked:!0})),n.filter?this.visit(function(e){var t=n.filter(e);if("skip"===t)return t;!1!==t&&l(e)}):!1!==e&&(o=this.getSelectedNodes(s),k.each(o,function(e,t){l(t)}))},getActiveNode:function(){return this.activeNode},getFirstChild:function(){return this.rootNode.getFirstChild()},getFocusNode:function(){return this.focusNode},getOption:function(e){return this.widget.option(e)},getNodeByKey:function(t,e){var n,i;return!e&&(n=document.getElementById(this.options.idPrefix+t))?n.ftnode||null:(e=e||this.rootNode,i=null,e.visit(function(e){if(e.key===t)return i=e,!1},!0),i)},getRootNode:function(){return this.rootNode},getSelectedNodes:function(e){return this.rootNode.getSelectedNodes(e)},hasFocus:function(){return!!this._hasFocus},info:function(e){3<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),g("info",arguments))},isLoading:function(){var t=!1;return this.rootNode.visit(function(e){if(e._isLoading||e._requestId)return!(t=!0)},!0),t},loadKeyPath:function(e,t){var i,n,r,o=this,a=new k.Deferred,s=this.getRootNode(),l=this.options.keyPathSeparator,d=[],c=k.extend({},t);for("function"==typeof t?i=t:t&&t.callback&&(i=t.callback),c.callback=function(e,t,n){i&&i.call(e,t,n),a.notifyWith(e,[{node:t,status:n}])},null==c.matchKey&&(c.matchKey=function(e,t){return e.key===t}),k.isArray(e)||(e=[e]),n=0;n<e.length;n++)(r=e[n]).charAt(0)===l&&(r=r.substr(1)),d.push(r.split(l));return setTimeout(function(){o._loadKeyPathImpl(a,c,s,d).done(function(){a.resolve()})},0),a.promise()},_loadKeyPathImpl:function(e,o,t,n){var i,r,a,s,l,d,c,h,u,f,p=this;for(c={},r=0;r<n.length;r++)for(u=n[r],h=t;u.length;){if(a=u.shift(),!(s=function(e,t){var n,i,r=e.children;if(r)for(n=0,i=r.length;n<i;n++)if(o.matchKey(r[n],t))return r[n];return null}(h,a))){this.warn("loadKeyPath: key not found: "+a+" (parent: "+h+")"),o.callback(this,a,"error");break}if(0===u.length){o.callback(this,s,"ok");break}if(s.lazy&&void 0===s.hasChildren()){o.callback(this,s,"loaded"),c[a=s.key]?c[a].pathSegList.push(u):c[a]={parent:s,pathSegList:[u]};break}o.callback(this,s,"loaded"),h=s}for(l in i=[],c)c.hasOwnProperty(l)&&(d=c[l],f=new k.Deferred,i.push(f),function(t,n,e){o.callback(p,n,"loading"),n.load().done(function(){p._loadKeyPathImpl.call(p,t,o,n,e).always(w(t,p))}).fail(function(e){p.warn("loadKeyPath: error loading lazy "+n),o.callback(p,s,"error"),t.rejectWith(p)})}(f,d.parent,d.pathSegList));return k.when.apply(k,i).promise()},reactivate:function(e){var t,n=this.activeNode;return n?(this.activeNode=null,t=n.setActive(!0,{noFocus:!0}),e&&n.setFocus(),t):N()},reload:function(e){return this._callHook("treeClear",this),this._callHook("treeLoad",this,e)},render:function(e,t){return this.rootNode.render(e,t)},selectAll:function(t){this.visit(function(e){e.setSelected(t)})},setFocus:function(e){return this._callHook("treeSetFocus",this,e)},setOption:function(e,t){return this.widget.option(e,t)},toDict:function(e,t){t=this.rootNode.toDict(!0,t);return e?t:t.children},toString:function(){return"Fancytree@"+this._id},_triggerNodeEvent:function(e,t,n,i){t=this._makeHookContext(t,n,i),i=this.widget._trigger(e,n,t);return!1!==i&&void 0!==t.result?t.result:i},_triggerTreeEvent:function(e,t,n){n=this._makeHookContext(this,t,n),e=this.widget._trigger(e,t,n);return!1!==e&&void 0!==n.result?n.result:e},visit:function(e){return this.rootNode.visit(e,!1)},visitRows:function(t,e){if(!this.rootNode.children)return!1;if(e&&e.reverse)return delete e.reverse,this._visitRowsUp(t,e);for(var n,i,r=0,o=!1===(e=e||{}).includeSelf,a=!!e.includeHidden,s=!a&&this.enableFilter,l=e.start||this.rootNode.children[0],d=l.parent;d;){for(n=(i=d.children).indexOf(l)+r;n<i.length;n++)if(l=i[n],!s||l.match||l.subMatchCount){if(!o&&!1===t(l))return!1;if(o=!1,l.children&&l.children.length&&(a||l.expanded)&&!1===l.visit(function(e){return!s||e.match||e.subMatchCount?!1!==t(e)&&(a||!e.children||e.expanded?void 0:"skip"):"skip"},!1))return!1}d=(l=d).parent,r=1}return!0},_visitRowsUp:function(e,t){for(var n,i,r,o=!!t.includeHidden,a=t.start||this.rootNode.children[0];;){if((n=(r=a.parent).children)[0]===a){if(!(a=r).parent)break;n=r.children}else for(i=n.indexOf(a),a=n[i-1];(o||a.expanded)&&a.children&&a.children.length;)a=(n=(r=a).children)[n.length-1];if((o||a.isVisible())&&!1===e(a))return!1}},warn:function(e){2<=this.options.debugLevel&&(Array.prototype.unshift.call(arguments,this.toString()),g("warn",arguments))}},{nodeClick:function(e){var t,n,i=e.targetType,r=e.node;if("expander"===i)r.isLoading()?r.debug("Got 2nd click while loading: ignored"):this._callHook("nodeToggleExpanded",e);else if("checkbox"===i)this._callHook("nodeToggleSelected",e),e.options.focusOnSelect&&this._callHook("nodeSetFocus",e,!0);else{if(t=!(n=!1),r.folder)switch(e.options.clickFolderMode){case 2:t=!(n=!0);break;case 3:n=t=!0}t&&(this.nodeSetFocus(e),this._callHook("nodeSetActive",e,!0)),n&&this._callHook("nodeToggleExpanded",e)}},nodeCollapseSiblings:function(e,t){var n,i,r,o=e.node;if(o.parent)for(i=0,r=(n=o.parent.children).length;i<r;i++)n[i]!==o&&n[i].expanded&&this._callHook("nodeSetExpanded",n[i],!1,t)},nodeDblclick:function(e){"title"===e.targetType&&4===e.options.clickFolderMode&&this._callHook("nodeToggleExpanded",e),"title"===e.targetType&&e.originalEvent.preventDefault()},nodeKeydown:function(e){var t,n=e.originalEvent,i=e.node,r=e.tree,o=e.options,a=n.which,s=n.key||String.fromCharCode(a),l=!!(n.altKey||n.ctrlKey||n.metaKey),a=!f[a]&&!h[a]&&!l,l=k(n.target),d=!0,c=!(n.ctrlKey||!o.autoActivate);if(i||(t=this.getActiveNode()||this.getFirstChild())&&(t.setFocus(),(i=e.node=this.focusNode).debug("Keydown force focus on active node")),o.quicksearch&&a&&!l.is(":input:enabled"))500<(t=Date.now())-r.lastQuicksearchTime&&(r.lastQuicksearchTerm=""),r.lastQuicksearchTime=t,r.lastQuicksearchTerm+=s,(a=r.findNextNode(r.lastQuicksearchTerm,r.getActiveNode()))&&a.setActive(),n.preventDefault();else{switch(u.eventToString(n)){case"+":case"=":r.nodeSetExpanded(e,!0);break;case"-":r.nodeSetExpanded(e,!1);break;case"space":i.isPagingNode()?r._triggerNodeEvent("clickPaging",e,n):u.evalOption("checkbox",i,i,o,!1)?r.nodeToggleSelected(e):r.nodeSetActive(e,!0);break;case"return":r.nodeSetActive(e,!0);break;case"home":case"end":case"backspace":case"left":case"right":case"up":case"down":i.navigate(n.which,c);break;default:d=!1}d&&n.preventDefault()}},nodeLoadChildren:function(o,a){var t,n,e,s=o.tree,l=o.node,d=Date.now();return k.isFunction(a)&&(a=a.call(s,{type:"source"},o),_(!k.isFunction(a),"source callback must not return another function")),a.url&&(l._requestId&&l.warn("Recursive load request #"+d+" while #"+l._requestId+" is pending."),t=k.extend({},o.options.ajax,a),l._requestId=d,e=t.debugDelay?(n=t.debugDelay,delete t.debugDelay,k.isArray(n)&&(n=n[0]+Math.random()*(n[1]-n[0])),l.warn("nodeLoadChildren waiting debugDelay "+Math.round(n)+" ms ..."),k.Deferred(function(e){setTimeout(function(){k.ajax(t).done(function(){e.resolveWith(this,arguments)}).fail(function(){e.rejectWith(this,arguments)})},n)})):k.ajax(t),a=new k.Deferred,e.done(function(e,t,n){var i,r;if("json"!==this.dataType&&"jsonp"!==this.dataType||"string"!=typeof e||k.error("Ajax request returned a string (did you get the JSON dataType wrong?)."),l._requestId&&l._requestId>d)a.rejectWith(this,[c]);else{if(o.options.postProcess){try{r=s._triggerNodeEvent("postProcess",o,o.originalEvent,{response:e,error:null,dataType:this.dataType})}catch(e){r={error:e,message:""+e,details:"postProcess failed"}}if(r.error)return i=k.isPlainObject(r.error)?r.error:{message:r.error},i=s._makeHookContext(l,null,i),void a.rejectWith(this,[i]);(k.isArray(r)||k.isPlainObject(r)&&k.isArray(r.children))&&(e=r)}else e&&e.hasOwnProperty("d")&&o.options.enableAspx&&(e="string"==typeof e.d?k.parseJSON(e.d):e.d);a.resolveWith(this,[e])}}).fail(function(e,t,n){e=s._makeHookContext(l,null,{error:e,args:Array.prototype.slice.call(arguments),message:n,details:e.status+": "+n});a.rejectWith(this,[e])})),k.isFunction(a.then)&&k.isFunction(a.catch)&&(e=a,a=new k.Deferred,e.then(function(e){a.resolve(e)},function(e){a.reject(e)})),k.isFunction(a.promise)?(s.nodeSetStatus(o,"loading"),a.done(function(e){s.nodeSetStatus(o,"ok"),l._requestId=null}).fail(function(e){var t;e!==c?(e.node&&e.error&&e.message?t=e:"[object Object]"===(t=s._makeHookContext(l,null,{error:e,args:Array.prototype.slice.call(arguments),message:e?e.message||e.toString():""})).message&&(t.message=""),l.warn("Load children failed ("+t.message+")",t),!1!==s._triggerNodeEvent("loadError",t,null)&&s.nodeSetStatus(o,"error",t.message,t.details)):l.warn("Ignored response for obsolete load request #"+d+" (expected #"+l._requestId+")")})):o.options.postProcess&&(e=s._triggerNodeEvent("postProcess",o,o.originalEvent,{response:a,error:null,dataType:typeof a}),k.isArray(e)||k.isPlainObject(e)&&k.isArray(e.children))&&(a=e),k.when(a).done(function(e){var n,t;k.isPlainObject(e)&&(_(l.isRootNode(),"source may only be an object for root nodes (expecting an array of child objects otherwise)"),_(k.isArray(e.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),e=(n=e).children,delete n.children,k.each(p,function(e,t){void 0!==n[t]&&(s[t]=n[t],delete n[t])}),k.extend(s.data,n)),_(k.isArray(e),"expected array of children"),l._setChildren(e),s.options.nodata&&0===e.length&&(k.isFunction(s.options.nodata)?t=s.options.nodata.call(s,{type:"nodata"},o):!0===s.options.nodata&&l.isRootNode()?t=s.options.strings.nodata:"string"==typeof s.options.nodata&&l.isRootNode()&&(t=s.options.nodata),t)&&l.setStatus("nodata",t),s._triggerNodeEvent("loadChildren",l)})},nodeLoadKeyPath:function(e,t){},nodeRemoveChild:function(e,t){var n=e.node,i=k.extend({},e,{node:t}),r=n.children;if(1===r.length)return _(t===r[0],"invalid single child"),this.nodeRemoveChildren(e);this.activeNode&&(t===this.activeNode||this.activeNode.isDescendantOf(t))&&this.activeNode.setActive(!1),this.focusNode&&(t===this.focusNode||this.focusNode.isDescendantOf(t))&&(this.focusNode=null),this.nodeRemoveMarkup(i),this.nodeRemoveChildren(i),_(0<=(e=k.inArray(t,r)),"invalid child"),n.triggerModifyChild("remove",t),t.visit(function(e){e.parent=null},!0),this._callHook("treeRegisterNode",this,!1,t),r.splice(e,1)},nodeRemoveChildMarkup:function(e){e=e.node;e.ul&&(e.isRootNode()?k(e.ul).empty():(k(e.ul).remove(),e.ul=null),e.visit(function(e){e.li=e.ul=null}))},nodeRemoveChildren:function(e){var t=e.tree,n=e.node;n.children&&(this.activeNode&&this.activeNode.isDescendantOf(n)&&this.activeNode.setActive(!1),this.focusNode&&this.focusNode.isDescendantOf(n)&&(this.focusNode=null),this.nodeRemoveChildMarkup(e),n.triggerModifyChild("remove",null),n.visit(function(e){e.parent=null,t._callHook("treeRegisterNode",t,!1,e)}),n.lazy?n.children=[]:n.children=null,n.isRootNode()||(n.expanded=!1),this.nodeRenderStatus(e))},nodeRemoveMarkup:function(e){var t=e.node;t.li&&(k(t.li).remove(),t.li=null),this.nodeRemoveChildMarkup(e)},nodeRender:function(e,t,n,i,r){var o,a,s,l,d,c,h,u=e.node,f=e.tree,p=e.options,g=p.aria,v=!1,y=u.parent,b=!y,m=u.children,x=null;if(!1!==f._enableUpdate&&(b||y.ul)){if(_(b||y.ul,"parent UL must exist"),b||(u.li&&(t||u.li.parentNode!==u.parent.ul)&&(u.li.parentNode===u.parent.ul?x=u.li.nextSibling:this.debug("Unlinking "+u+" (must be child of "+u.parent+")"),this.nodeRemoveMarkup(e)),u.li?this.nodeRenderStatus(e):(v=!0,u.li=document.createElement("li"),(u.li.ftnode=u).key&&p.generateIds&&(u.li.id=p.idPrefix+u.key),u.span=document.createElement("span"),u.span.className="fancytree-node",g&&!u.tr&&k(u.li).attr("role","treeitem"),u.li.appendChild(u.span),this.nodeRenderTitle(e),p.createNode&&p.createNode.call(f,{type:"createNode"},e)),p.renderNode&&p.renderNode.call(f,{type:"renderNode"},e)),m){if(b||u.expanded||!0===n){for(u.ul||(u.ul=document.createElement("ul"),(!0!==i||r)&&u.expanded||(u.ul.style.display="none"),g&&k(u.ul).attr("role","group"),u.li?u.li.appendChild(u.ul):u.tree.$div.append(u.ul)),l=0,d=m.length;l<d;l++)h=k.extend({},e,{node:m[l]}),this.nodeRender(h,t,n,!1,!0);for(o=u.ul.firstChild;o;)o=(s=o.ftnode)&&s.parent!==u?(u.debug("_fixParent: remove missing "+s,o),c=o.nextSibling,o.parentNode.removeChild(o),c):o.nextSibling;for(o=u.ul.firstChild,l=0,d=m.length-1;l<d;l++)(a=m[l])===(s=o.ftnode)?o=o.nextSibling:u.ul.insertBefore(a.li,s.li)}}else u.ul&&(this.warn("remove child markup for "+u),this.nodeRemoveChildMarkup(e));b||v&&y.ul.insertBefore(u.li,x)}},nodeRenderTitle:function(e,t){var n,i=e.node,r=e.tree,o=e.options,a=o.aria,s=i.getLevel(),l=[];void 0!==t&&(i.title=t),i.span&&!1!==r._enableUpdate&&(t=a&&!1!==i.hasChildren()?" role='button'":"",s<o.minExpandLevel?(i.lazy||(i.expanded=!0),1<s&&l.push("<span "+t+" class='fancytree-expander fancytree-expander-fixed'></span>")):l.push("<span "+t+" class='fancytree-expander'></span>"),(s=u.evalOption("checkbox",i,i,o,!1))&&!i.isStatusNode()&&(n="fancytree-checkbox",("radio"===s||i.parent&&i.parent.radiogroup)&&(n+=" fancytree-radio"),l.push("<span "+(t=a?" role='checkbox'":"")+" class='"+n+"'></span>")),void 0!==i.data.iconClass&&(i.icon?k.error("'iconClass' node option is deprecated since v2.14.0: use 'icon' only instead"):(i.warn("'iconClass' node option is deprecated since v2.14.0: use 'icon' instead"),i.icon=i.data.iconClass)),!1!==(s=u.evalOption("icon",i,i,o,!0))&&(t=a?" role='presentation'":"",n=(n=u.evalOption("iconTooltip",i,i,o,null))?" title='"+E(n)+"'":"","string"==typeof s?d.test(s)?(s="/"===s.charAt(0)?s:(o.imagePath||"")+s,l.push("<img src='"+s+"' class='fancytree-icon'"+n+" alt='' />")):l.push("<span "+t+" class='fancytree-custom-icon "+s+"'"+n+"></span>"):s.text?l.push("<span "+t+" class='fancytree-custom-icon "+(s.addClass||"")+"'"+n+">"+u.escapeHtml(s.text)+"</span>"):s.html?l.push("<span "+t+" class='fancytree-custom-icon "+(s.addClass||"")+"'"+n+">"+s.html+"</span>"):l.push("<span "+t+" class='fancytree-icon'"+n+"></span>")),a="",(a=o.renderTitle?o.renderTitle.call(r,{type:"renderTitle"},e)||"":a)||(a="<span class='fancytree-title'"+(s=(s=!0===(s=u.evalOption("tooltip",i,i,o,null))?i.title:s)?" title='"+E(s)+"'":"")+(o.titlesTabbable?" tabindex='0'":"")+">"+(o.escapeTitles?u.escapeHtml(i.title):i.title)+"</span>"),l.push(a),i.span.innerHTML=l.join(""),this.nodeRenderStatus(e),o.enhanceTitle)&&(e.$title=k(">span.fancytree-title",i.span),o.enhanceTitle.call(r,{type:"enhanceTitle"},e))},nodeRenderStatus:function(e){var t,n=e.node,i=e.tree,e=e.options,r=n.hasChildren(),o=n.isLastSibling(),a=e.aria,s=e._classNames,l=[],d=n[i.statusClassPropName];d&&!1!==i._enableUpdate&&(a&&(t=k(n.tr||n.li)),l.push(s.node),i.activeNode===n&&l.push(s.active),i.focusNode===n&&l.push(s.focused),n.expanded&&l.push(s.expanded),a&&(!1===r?t.removeAttr("aria-expanded"):t.attr("aria-expanded",Boolean(n.expanded))),n.folder&&l.push(s.folder),!1!==r&&l.push(s.hasChildren),o&&l.push(s.lastsib),n.lazy&&null==n.children&&l.push(s.lazy),n.partload&&l.push(s.partload),n.partsel&&l.push(s.partsel),u.evalOption("unselectable",n,n,e,!1)&&l.push(s.unselectable),n._isLoading&&l.push(s.loading),n._error&&l.push(s.error),n.statusNodeType&&l.push(s.statusNodePrefix+n.statusNodeType),n.selected?(l.push(s.selected),a&&t.attr("aria-selected",!0)):a&&t.attr("aria-selected",!1),n.extraClasses&&l.push(n.extraClasses),l.push(!1===r?s.combinedExpanderPrefix+"n"+(o?"l":""):s.combinedExpanderPrefix+(n.expanded?"e":"c")+(n.lazy&&null==n.children?"d":"")+(o?"l":"")),l.push(s.combinedIconPrefix+(n.expanded?"e":"c")+(n.folder?"f":"")),d.className=l.join(" "),n.li)&&k(n.li).toggleClass(s.lastsib,o)},nodeSetActive:function(e,t,n){var i=e.node,r=e.tree,o=e.options,a=!0===(n=n||{}).noEvents,s=!0===n.noFocus,n=!1!==n.scrollIntoView;return i===r.activeNode==(t=!1!==t)?N(i):t&&!a&&!1===this._triggerNodeEvent("beforeActivate",i,e.originalEvent)?C(i,["rejected"]):(t?(r.activeNode&&(_(r.activeNode!==i,"node was active (inconsistency)"),t=k.extend({},e,{node:r.activeNode}),r.nodeSetActive(t,!1),_(null===r.activeNode,"deactivate was out of sync?")),o.activeVisible&&i.makeVisible({scrollIntoView:n}),r.activeNode=i,r.nodeRenderStatus(e),s||r.nodeSetFocus(e),a||r._triggerNodeEvent("activate",i,e.originalEvent)):(_(r.activeNode===i,"node was not active (inconsistency)"),r.activeNode=null,this.nodeRenderStatus(e),a||e.tree._triggerNodeEvent("deactivate",i,e.originalEvent)),N(i))},nodeSetExpanded:function(i,r,e){var t,n,o,a,s,l,d=i.node,c=i.tree,h=i.options,u=!0===(e=e||{}).noAnimation,f=!0===e.noEvents;if(r=!1!==r,d.expanded&&r||!d.expanded&&!r)return N(d);if(r&&!d.lazy&&!d.hasChildren())return N(d);if(!r&&d.getLevel()<h.minExpandLevel)return C(d,["locked"]);if(!f&&!1===this._triggerNodeEvent("beforeExpand",d,i.originalEvent))return C(d,["rejected"]);if(u||d.isVisible()||(u=e.noAnimation=!0),n=new k.Deferred,r&&!d.expanded&&h.autoCollapse){s=d.getParentList(!1,!0),l=h.autoCollapse;try{for(h.autoCollapse=!1,o=0,a=s.length;o<a;o++)this._callHook("nodeCollapseSiblings",s[o],e)}finally{h.autoCollapse=l}}return n.done(function(){var e=d.getLastChild();r&&h.autoScroll&&!u&&e&&c._enableUpdate?e.scrollIntoView(!0,{topNode:d}).always(function(){f||i.tree._triggerNodeEvent(r?"expand":"collapse",i)}):f||i.tree._triggerNodeEvent(r?"expand":"collapse",i)}),t=function(e){var t=h._classNames,n=h.toggleEffect;if(d.expanded=r,c._callHook("treeStructureChanged",i,r?"expand":"collapse"),c._callHook("nodeRender",i,!1,!1,!0),d.ul)if("none"!==d.ul.style.display==!!d.expanded)d.warn("nodeSetExpanded: UL.style.display already set");else{if(n&&!u)return k(d.li).addClass(t.animating),void(k.isFunction(k(d.ul)[n.effect])?k(d.ul)[n.effect]({duration:n.duration,always:function(){k(this).removeClass(t.animating),k(d.li).removeClass(t.animating),e()}}):(k(d.ul).stop(!0,!0),k(d.ul).parent().find(".ui-effects-placeholder").remove(),k(d.ul).toggle(n.effect,n.options,n.duration,function(){k(this).removeClass(t.animating),k(d.li).removeClass(t.animating),e()})));d.ul.style.display=d.expanded||!parent?"":"none"}e()},r&&d.lazy&&void 0===d.hasChildren()?d.load().done(function(){n.notifyWith&&n.notifyWith(d,["loaded"]),t(function(){n.resolveWith(d)})}).fail(function(e){t(function(){n.rejectWith(d,["load failed ("+e+")"])})}):t(function(){n.resolveWith(d)}),n.promise()},nodeSetFocus:function(e,t){var n,i=e.tree,r=e.node,o=i.options,a=!!e.originalEvent&&k(e.originalEvent.target).is(":input");if(t=!1!==t,i.focusNode){if(i.focusNode===r&&t)return;n=k.extend({},e,{node:i.focusNode}),i.focusNode=null,this._triggerNodeEvent("blur",n),this._callHook("nodeRenderStatus",n)}t&&(this.hasFocus()||(r.debug("nodeSetFocus: forcing container focus"),this._callHook("treeSetFocus",e,!0,{calledByNode:!0})),r.makeVisible({scrollIntoView:!1}),i.focusNode=r,o.titlesTabbable&&!a&&k(r.span).find(".fancytree-title").focus(),o.aria&&k(i.$container).attr("aria-activedescendant",k(r.tr||r.li).uniqueId().attr("id")),this._triggerNodeEvent("focus",e),document.activeElement===i.$container.get(0)||1<=k(document.activeElement,i.$container).length||k(i.$container).focus(),o.autoScroll&&r.scrollIntoView(),this._callHook("nodeRenderStatus",e))},nodeSetSelected:function(e,t,n){var i=e.node,r=e.tree,o=e.options,a=!0===(n=n||{}).noEvents,s=i.parent;if(t=!1!==t,!u.evalOption("unselectable",i,i,o,!1))return i._lastSelectIntent=t,!!i.selected!==t||3===o.selectMode&&i.partsel&&!t?a||!1!==this._triggerNodeEvent("beforeSelect",i,e.originalEvent)?(t&&1===o.selectMode?(r.lastSelectedNode&&r.lastSelectedNode.setSelected(!1),i.selected=t):3!==o.selectMode||!s||s.radiogroup||i.radiogroup?s&&s.radiogroup?i.visitSiblings(function(e){e._changeSelectStatusAttrs(t&&e===i)},!0):i.selected=t:(i.selected=t,i.fixSelection3AfterClick(n)),this.nodeRenderStatus(e),r.lastSelectedNode=t?i:null,void(a||r._triggerNodeEvent("select",e))):!!i.selected:t},nodeSetStatus:function(i,e,t,n){var r=i.node,o=i.tree;function a(e,t){var n=r.children?r.children[0]:null;n&&n.isStatusNode()?(k.extend(n,e),n.statusNodeType=t,o._callHook("nodeRenderTitle",n)):(r._setChildren([e]),o._callHook("treeStructureChanged",i,"setStatusNode"),r.children[0].statusNodeType=t,o.render()),r.children[0]}switch(e){case"ok":var s=r.children?r.children[0]:null;if(s&&s.isStatusNode()){try{r.ul&&(r.ul.removeChild(s.li),s.li=null)}catch(s){}1===r.children.length?r.children=[]:r.children.shift(),o._callHook("treeStructureChanged",i,"clearStatusNode")}r._isLoading=!1,r._error=null,r.renderStatus();break;case"loading":r.parent||a({title:o.options.strings.loading+(t?" ("+t+")":""),checkbox:!1,tooltip:n},e),r._isLoading=!0,r._error=null,r.renderStatus();break;case"error":a({title:o.options.strings.loadError+(t?" ("+t+")":""),checkbox:!1,tooltip:n},e),r._isLoading=!1,r._error={message:t,details:n},r.renderStatus();break;case"nodata":a({title:t||o.options.strings.noData,checkbox:!1,tooltip:n},e),r._isLoading=!1,r._error=null,r.renderStatus();break;default:k.error("invalid node status "+e)}},nodeToggleExpanded:function(e){return this.nodeSetExpanded(e,!e.node.expanded)},nodeToggleSelected:function(e){var t=e.node,n=!t.selected;return t.partsel&&!t.selected&&!0===t._lastSelectIntent&&(t.selected=!(n=!1)),t._lastSelectIntent=n,this.nodeSetSelected(e,n)},treeClear:function(e){var t=e.tree;t.activeNode=null,t.focusNode=null,t.$div.find(">ul.fancytree-container").empty(),t.rootNode.children=null,t._callHook("treeStructureChanged",e,"clear")},treeCreate:function(e){},treeDestroy:function(e){this.$div.find(">ul.fancytree-container").remove(),this.$source&&this.$source.removeClass("fancytree-helper-hidden")},treeInit:function(e){var n=e.tree,i=n.options;n.$container.attr("tabindex",i.tabindex),k.each(p,function(e,t){void 0!==i[t]&&(n.info("Move option "+t+" to tree"),n[t]=i[t],delete i[t])}),i.checkboxAutoHide&&n.$container.addClass("fancytree-checkbox-auto-hide"),i.rtl?n.$container.attr("DIR","RTL").addClass("fancytree-rtl"):n.$container.removeAttr("DIR").removeClass("fancytree-rtl"),i.aria&&(n.$container.attr("role","tree"),1!==i.selectMode)&&n.$container.attr("aria-multiselectable",!0),this.treeLoad(e)},treeLoad:function(e,t){var n,i,r,o=e.tree,a=e.widget.element,s=k.extend({},e,{node:this.rootNode});if(o.rootNode.children&&this.treeClear(e),t=t||this.options.source)"string"==typeof t&&k.error("Not implemented");else switch(i=a.data("type")||"html"){case"html":(r=a.find(">ul").not(".fancytree-container").first()).length?(r.addClass("ui-fancytree-source fancytree-helper-hidden"),t=k.ui.fancytree.parseHtml(r),this.data=k.extend(this.data,S(r))):(u.warn("No `source` option was passed and container does not contain `<ul>`: assuming `source: []`."),t=[]);break;case"json":t=k.parseJSON(a.text()),a.contents().filter(function(){return 3===this.nodeType}).remove(),k.isPlainObject(t)&&(_(k.isArray(t.children),"if an object is passed as source, it must contain a 'children' array (all other properties are added to 'tree.data')"),t=(n=t).children,delete n.children,k.each(p,function(e,t){void 0!==n[t]&&(o[t]=n[t],delete n[t])}),k.extend(o.data,n));break;default:k.error("Invalid data-type: "+i)}return o._triggerTreeEvent("preInit",null),this.nodeLoadChildren(s,t).done(function(){o._callHook("treeStructureChanged",e,"loadChildren"),o.render(),3===e.options.selectMode&&o.rootNode.fixSelection3FromEndNodes(),o.activeNode&&o.options.activeVisible&&o.activeNode.makeVisible(),o._triggerTreeEvent("init",null,{status:!0})}).fail(function(){o.render(),o._triggerTreeEvent("init",null,{status:!1})})},treeRegisterNode:function(e,t,n){e.tree._callHook("treeStructureChanged",e,t?"addNode":"removeNode")},treeSetFocus:function(e,t,n){(t=!1!==t)!==this.hasFocus()&&(!(this._hasFocus=t)&&this.focusNode?this.focusNode.setFocus(!1):!t||n&&n.calledByNode||k(this.$container).focus(),this.$container.toggleClass("fancytree-treefocus",t),this._triggerTreeEvent(t?"focusTree":"blurTree"),t)&&!this.activeNode&&(n=this._lastMousedownNode||this.getFirstChild())&&n.setFocus()},treeSetOption:function(e,t,n){var i=e.tree,r=!0,o=!1,a=!1;switch(t){case"aria":case"checkbox":case"icon":case"minExpandLevel":case"tabindex":a=o=!0;break;case"checkboxAutoHide":i.$container.toggleClass("fancytree-checkbox-auto-hide",!!n);break;case"escapeTitles":case"tooltip":a=!0;break;case"rtl":!1===n?i.$container.removeAttr("DIR").removeClass("fancytree-rtl"):i.$container.attr("DIR","RTL").addClass("fancytree-rtl"),a=!0;break;case"source":r=!1,i._callHook("treeLoad",i,n),a=!0}i.debug("set option "+t+"="+n+" <"+typeof n+">"),r&&(this.widget._super||k.Widget.prototype._setOption).call(this.widget,t,n),o&&i._callHook("treeCreate",i),a&&i.render(!0,!1)},treeStructureChanged:function(e,t){}}),k.widget("ui.fancytree",{options:{activeVisible:!0,ajax:{type:"GET",cache:!1,dataType:"json"},aria:!0,autoActivate:!0,autoCollapse:!1,autoScroll:!1,checkbox:!1,clickFolderMode:4,debugLevel:null,disabled:!1,enableAspx:!0,escapeTitles:!1,extensions:[],toggleEffect:{effect:"slideToggle",duration:200},generateIds:!1,icon:!0,idPrefix:"ft_",focusOnSelect:!1,keyboard:!0,keyPathSeparator:"/",minExpandLevel:1,nodata:!0,quicksearch:!1,rtl:!1,scrollOfs:{top:0,bottom:0},scrollParent:null,selectMode:2,strings:{loading:"Loading...",loadError:"Load error!",moreData:"More...",noData:"No data."},tabindex:"0",titlesTabbable:!1,tooltip:!1,treeId:null,_classNames:{node:"fancytree-node",folder:"fancytree-folder",animating:"fancytree-animating",combinedExpanderPrefix:"fancytree-exp-",combinedIconPrefix:"fancytree-ico-",hasChildren:"fancytree-has-children",active:"fancytree-active",selected:"fancytree-selected",expanded:"fancytree-expanded",lazy:"fancytree-lazy",focused:"fancytree-focused",partload:"fancytree-partload",partsel:"fancytree-partsel",radio:"fancytree-radio",unselectable:"fancytree-unselectable",lastsib:"fancytree-lastsib",loading:"fancytree-loading",error:"fancytree-error",statusNodePrefix:"fancytree-statusnode-"},lazyLoad:null,postProcess:null},_create:function(){this.tree=new A(this),this.$source=this.source||"json"===this.element.data("type")?this.element:this.element.find(">ul").first();var e,t,n,i=this.options,r=i.extensions;for(this.tree,n=0;n<r.length;n++){t=r[n],(e=k.ui.fancytree._extensions[t])||k.error("Could not apply extension '"+t+"' (it is not registered, did you forget to include it?)"),this.tree.options[t]=function e(){var t,n,i,r,o=arguments[0]||{},a=1,s=arguments.length;if("object"==typeof o||k.isFunction(o)||(o={}),a===s)throw Error("need at least two args");for(;a<s;a++)if(null!=(t=arguments[a]))for(n in t)if(t.hasOwnProperty(n)){if(r=o[n],o===(i=t[n]))continue;i&&k.isPlainObject(i)?(r=r&&k.isPlainObject(r)?r:{},o[n]=e(r,i)):void 0!==i&&(o[n]=i)}return o}({},e.options,this.tree.options[t]),_(void 0===this.tree.ext[t],"Extension name must not exist as Fancytree.ext attribute: '"+t+"'"),this.tree.ext[t]={};{o=void 0;a=void 0;s=void 0;l=void 0;var o=this.tree;var a=e;var s=t;for(var l in a)"function"==typeof a[l]?"function"==typeof o[l]?o[l]=x(l,o,0,a,s):"_"===l.charAt(0)?o.ext[s][l]=x(l,o,0,a,s):k.error("Could not override tree."+l+". Use prefix '_' to create tree."+s+"._"+l):"options"!==l&&(o.ext[s][l]=a[l])}}void 0!==i.icons&&(!0===i.icon?(this.tree.warn("'icons' tree option is deprecated since v2.14.0: use 'icon' instead"),i.icon=i.icons):k.error("'icons' tree option is deprecated since v2.14.0: use 'icon' only instead")),void 0!==i.iconClass&&(i.icon?k.error("'iconClass' tree option is deprecated since v2.14.0: use 'icon' only instead"):(this.tree.warn("'iconClass' tree option is deprecated since v2.14.0: use 'icon' instead"),i.icon=i.iconClass)),void 0!==i.tabbable&&(i.tabindex=i.tabbable?"0":"-1",this.tree.warn("'tabbable' tree option is deprecated since v2.17.0: use 'tabindex='"+i.tabindex+"' instead")),this.tree._callHook("treeCreate",this.tree)},_init:function(){this.tree._callHook("treeInit",this.tree),this._bind()},_setOption:function(e,t){return this.tree._callHook("treeSetOption",this.tree,e,t)},destroy:function(){this._unbind(),this.tree._callHook("treeDestroy",this.tree),k.Widget.prototype.destroy.call(this)},_unbind:function(){var e=this.tree._ns;this.element.off(e),this.tree.$container.off(e),k(document).off(e)},_bind:function(){var a=this,s=this.options,o=this.tree,e=o._ns;this._unbind(),o.$container.on("focusin"+e+" focusout"+e,function(e){var t=u.getNode(e),n="focusin"===e.type;if(!n&&t&&k(e.target).is("a"))t.debug("Ignored focusout on embedded <a> element.");else{if(n){if(o._getExpiringValue("focusin"))return void o.debug("Ignored double focusin.");o._setExpiringValue("focusin",!0,50),t||(t=o._getExpiringValue("mouseDownNode"))&&o.debug("Reconstruct mouse target for focusin from recent event.")}t?o._callHook("nodeSetFocus",o._makeHookContext(t,e),n):o.tbody&&k(e.target).parents("table.fancytree-container > thead").length?o.debug("Ignore focus event outside table body.",e):o._callHook("treeSetFocus",o,n)}}).on("selectstart"+e,"span.fancytree-title",function(e){e.preventDefault()}).on("keydown"+e,function(e){if(s.disabled||!1===s.keyboard)return!0;var t,n=o.focusNode,i=o._makeHookContext(n||o,e),r=o.phase;try{return o.phase="userEvent","preventNav"===(t=n?o._triggerNodeEvent("keydown",n,e):o._triggerTreeEvent("keydown",e))?t=!0:!1!==t&&(t=o._callHook("nodeKeydown",i)),t}finally{o.phase=r}}).on("mousedown"+e,function(e){e=u.getEventTarget(e);o._lastMousedownNode=e?e.node:null,o._setExpiringValue("mouseDownNode",o._lastMousedownNode)}).on("click"+e+" dblclick"+e,function(e){if(s.disabled)return!0;var t,n=u.getEventTarget(e),i=n.node,r=a.tree,o=r.phase;if(!i)return!0;t=r._makeHookContext(i,e);try{switch(r.phase="userEvent",e.type){case"click":return t.targetType=n.type,i.isPagingNode()?!0===r._triggerNodeEvent("clickPaging",t,e):!1!==r._triggerNodeEvent("click",t,e)&&r._callHook("nodeClick",t);case"dblclick":return t.targetType=n.type,!1!==r._triggerNodeEvent("dblclick",t,e)&&r._callHook("nodeDblclick",t)}}finally{r.phase=o}})},getActiveNode:function(){return this.tree.activeNode},getNodeByKey:function(e){return this.tree.getNodeByKey(e)},getRootNode:function(){return this.tree.rootNode},getTree:function(){return this.tree}}),u=k.ui.fancytree,k.extend(k.ui.fancytree,{version:"2.33.0",buildType:"production",debugLevel:3,_nextId:1,_nextNodeKey:1,_extensions:{},_FancytreeClass:A,_FancytreeNodeClass:L,jquerySupports:{positionMyOfs:function(e){for(var t,n,i=k.map(k.trim(e).split("."),function(e){return parseInt(e,10)}),r=k.map(Array.prototype.slice.call(arguments,1),function(e){return parseInt(e,10)}),o=0;o<r.length;o++)if((t=i[o]||0)!==(n=r[o]||0))return n<t;return!0}(k.ui.version,1,9)},assert:_,createTree:function(e,t){return k(e).fancytree(t).fancytree("getTree")},debounce:function(t,n,i,r){var o;return 3===arguments.length&&"boolean"!=typeof i&&(r=i,i=!1),function(){var e=arguments;r=r||this,i&&!o&&n.apply(r,e),clearTimeout(o),o=setTimeout(function(){i||n.apply(r,e),o=null},t)}},debug:function(e){4<=k.ui.fancytree.debugLevel&&g("log",arguments)},error:function(e){1<=k.ui.fancytree.debugLevel&&g("error",arguments)},escapeHtml:function(e){return(""+e).replace(t,function(e){return i[e]})},fixPositionOptions:function(e){var t,n,i,r;return(e.offset||0<=(""+e.my+e.at).indexOf("%"))&&k.error("expected new position syntax (but '%' is not supported)"),!k.ui.fancytree.jquerySupports.positionMyOfs&&(t=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(e.my),n=/(\w+)([+-]?\d+)?\s+(\w+)([+-]?\d+)?/.exec(e.at),i=(t[2]?+t[2]:0)+(n[2]?+n[2]:0),r=(t[4]?+t[4]:0)+(n[4]?+n[4]:0),e=k.extend({},e,{my:t[1]+" "+t[3],at:n[1]+" "+n[3]}),i||r)&&(e.offset=i+" "+r),e},getEventTarget:function(e){var t=e&&e.target?e.target.className:"",n={node:this.getNode(e.target),type:void 0};return/\bfancytree-title\b/.test(t)?n.type="title":/\bfancytree-expander\b/.test(t)?n.type=!1===n.node.hasChildren()?"prefix":"expander":/\bfancytree-checkbox\b/.test(t)?n.type="checkbox":/\bfancytree(-custom)?-icon\b/.test(t)?n.type="icon":/\bfancytree-node\b/.test(t)?n.type="title":e&&e.target&&((t=k(e.target)).is("ul[role=group]")?((n.node&&n.node.tree||u).debug("Ignoring click on outer UL."),n.node=null):t.closest(".fancytree-title").length?n.type="title":t.closest(".fancytree-checkbox").length?n.type="checkbox":t.closest(".fancytree-expander").length&&(n.type="expander")),n},getEventTargetType:function(e){return this.getEventTarget(e).type},getNode:function(e){if(e instanceof L)return e;for(e instanceof k?e=e[0]:void 0!==e.originalEvent&&(e=e.target);e;){if(e.ftnode)return e.ftnode;e=e.parentNode}return null},getTree:function(e){var t=e;return e instanceof A?e:("number"==typeof(e=void 0===e?0:e)?e=k(".fancytree-container").eq(e):"string"==typeof e?(e=k("#ft-id-"+t).eq(0)).length||(e=k(t).eq(0)):e instanceof k?e=e.eq(0):void 0!==e.originalEvent&&(e=k(e.target)),(t=(e=e.closest(":ui-fancytree")).data("ui-fancytree")||e.data("fancytree"))?t.tree:null)},evalOption:function(e,t,n,i,r){var o,a=t.tree,i=i[e],n=n[e];return k.isFunction(i)?(t={node:t,tree:a,widget:a.widget,options:a.widget.options,typeInfo:a.types[t.type]||{}},null==(o=i.call(a,{type:e},t))&&(o=n)):o=null==n?i:n,o=null==o?r:o},setSpanIcon:function(e,t,n){var i=k(e);"string"==typeof n?i.attr("class",t+" "+n):(n.text?i.text(""+n.text):n.html&&(e.innerHTML=n.html),i.attr("class",t+" "+(n.addClass||"")))},eventToString:function(e){var t=e.which,n=e.type,i=[];return e.altKey&&i.push("alt"),e.ctrlKey&&i.push("ctrl"),e.metaKey&&i.push("meta"),e.shiftKey&&i.push("shift"),"click"===n||"dblclick"===n?i.push(o[e.button]+n):"wheel"===n?i.push(n):r[t]||i.push(h[t]||String.fromCharCode(t).toLowerCase()),i.join("+")},info:function(e){3<=k.ui.fancytree.debugLevel&&g("info",arguments)},keyEventToString:function(e){return this.warn("keyEventToString() is deprecated: use eventToString()"),this.eventToString(e)},overrideMethod:function(e,t,n,i){var r,o=e[t]||k.noop;e[t]=function(){var e=i||this;try{return r=e._super,e._super=o,n.apply(e,arguments)}finally{e._super=r}}},parseHtml:function(a){var s,l,d,c,h,u,f,p,e=a.find(">li"),g=[];return e.each(function(){var e,t,n=k(this),i=n.find(">span",this).first(),r=i.length?null:n.find(">a").first(),o={tooltip:null,data:{}};for(i.length?o.title=i.html():r&&r.length?(o.title=r.html(),o.data.href=r.attr("href"),o.data.target=r.attr("target"),o.tooltip=r.attr("title")):(o.title=n.html(),0<=(h=o.title.search(/<ul/i))&&(o.title=o.title.substring(0,h))),o.title=k.trim(o.title),c=0,u=v.length;c<u;c++)o[v[c]]=void 0;for(s=this.className.split(" "),d=[],c=0,u=s.length;c<u;c++)l=s[c],y[l]?o[l]=!0:d.push(l);if(o.extraClasses=d.join(" "),(f=n.attr("title"))&&(o.tooltip=f),(f=n.attr("id"))&&(o.key=f),n.attr("hideCheckbox")&&(o.checkbox=!1),(e=S(n))&&!k.isEmptyObject(e)){for(t in m)e.hasOwnProperty(t)&&(e[m[t]]=e[t],delete e[t]);for(c=0,u=b.length;c<u;c++)f=b[c],null!=(p=e[f])&&(delete e[f],o[f]=p);k.extend(o.data,e)}(a=n.find(">ul").first()).length?o.children=k.ui.fancytree.parseHtml(a):o.children=o.lazy?void 0:null,g.push(o)}),g},registerExtension:function(e){_(null!=e.name,"extensions must have a `name` property."),_(null!=e.version,"extensions must have a `version` property."),k.ui.fancytree._extensions[e.name]=e},unescapeHtml:function(e){var t=document.createElement("div");return t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue},warn:function(e){2<=k.ui.fancytree.debugLevel&&g("warn",arguments)}}),k.ui.fancytree}function _(e,t){e||k.error("Fancytree assertion failed"+(t=t?": "+t:""))}function g(e,t){var n,i,r=window.console?window.console[e]:null;if(r)try{r.apply(window.console,t)}catch(e){for(i="",n=0;n<t.length;n++)i+=t[n];r(i)}}function x(e,i,t,n,r){var o=i[e],a=n[e],s=i.ext[r],l=function(){return o.apply(i,arguments)},d=function(e){return o.apply(i,e)};return function(){var e=i._local,t=i._super,n=i._superApply;try{return i._local=s,i._super=l,i._superApply=d,a.apply(i,arguments)}finally{i._local=e,i._super=t,i._superApply=n}}}function N(e,t){return(void 0===e?k.Deferred(function(){this.resolve()}):k.Deferred(function(){this.resolveWith(e,t)})).promise()}function C(e,t){return(void 0===e?k.Deferred(function(){this.reject()}):k.Deferred(function(){this.rejectWith(e,t)})).promise()}function w(e,t){return function(){e.resolveWith(t)}}function S(e){var e=k.extend({},e.data()),t=e.json;return delete e.fancytree,delete e.uiFancytree,t&&(delete e.json,e=k.extend(e,t)),e}function E(e){return(""+e).replace(n,function(e){return i[e]})}function T(t){return t=t.toLowerCase(),function(e){return 0<=e.title.toLowerCase().indexOf(t)}}function L(e,t){var n,i,r;for(this.parent=e,this.tree=e.tree,this.ul=null,this.li=null,this.statusNodeType=null,this._isLoading=!1,this._error=null,this.data={},n=0,i=b.length;n<i;n++)this[r=b[n]]=t[r];for(r in null==this.unselectableIgnore&&null==this.unselectableStatus||(this.unselectable=!0),t.hideCheckbox&&k.error("'hideCheckbox' node option was removed in v2.23.0: use 'checkbox: false'"),t.data&&k.extend(this.data,t.data),t)a[r]||k.isFunction(t[r])||s[r]||(this.data[r]=t[r]);null==this.key?this.tree.options.defaultKey?(this.key=this.tree.options.defaultKey(this),_(this.key,"defaultKey() must return a unique key")):this.key="_"+u._nextNodeKey++:this.key=""+this.key,t.active&&(_(null===this.tree.activeNode,"only one active node allowed"),this.tree.activeNode=this),t.selected&&(this.tree.lastSelectedNode=this),(e=t.children)?e.length?this._setChildren(e):this.children=this.lazy?[]:null:this.children=null,this.tree._callHook("treeRegisterNode",this.tree,!0,this)}function A(e){this.widget=e,this.$div=e.element,this.options=e.options,this.options&&(void 0!==this.options.lazyload&&k.error("The 'lazyload' event is deprecated since 2014-02-25. Use 'lazyLoad' (with uppercase L) instead."),void 0!==this.options.loaderror&&k.error("The 'loaderror' event was renamed since 2014-07-03. Use 'loadError' (with uppercase E) instead."),void 0!==this.options.fx&&k.error("The 'fx' option was replaced by 'toggleEffect' since 2014-11-30."),void 0!==this.options.removeNode)&&k.error("The 'removeNode' event was replaced by 'modifyChild' since 2.20 (2016-09-10)."),this.ext={},this.types={},this.columns={},this.data=S(this.$div),this._id=""+(this.options.treeId||k.ui.fancytree._nextId++),this._ns=".fancytree-"+this._id,this.activeNode=null,this.focusNode=null,this._hasFocus=null,this._tempCache={},this._lastMousedownNode=null,this._enableUpdate=!0,this.lastSelectedNode=null,this.systemFocusElement=null,this.lastQuicksearchTerm="",this.lastQuicksearchTime=0,this.viewport=null,this.statusClassPropName="span",this.ariaPropName="li",this.nodeContainerAttrName="li",this.$div.find(">ul.fancytree-container").remove(),this.rootNode=new L({tree:this},{title:"root",key:"root_"+this._id,children:null,expanded:!0}),this.rootNode.parent=null,e=k("<ul>",{id:"ft-id-"+this._id,class:"ui-fancytree fancytree-container fancytree-plain"}).appendTo(this.$div),this.$container=e,this.rootNode.ul=e[0],null==this.options.debugLevel&&(this.options.debugLevel=u.debugLevel)}k.ui.fancytree.warn("Fancytree: ignored duplicate include")}),function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)}(function(s){"use strict";var a=s.ui.fancytree,n={awesome3:{_addClass:"",checkbox:"icon-check-empty",checkboxSelected:"icon-check",checkboxUnknown:"icon-check icon-muted",dragHelper:"icon-caret-right",dropMarker:"icon-caret-right",error:"icon-exclamation-sign",expanderClosed:"icon-caret-right",expanderLazy:"icon-angle-right",expanderOpen:"icon-caret-down",loading:"icon-refresh icon-spin",nodata:"icon-meh",noExpander:"",radio:"icon-circle-blank",radioSelected:"icon-circle",doc:"icon-file-alt",docOpen:"icon-file-alt",folder:"icon-folder-close-alt",folderOpen:"icon-folder-open-alt"},awesome4:{_addClass:"fa",checkbox:"fa-square-o",checkboxSelected:"fa-check-square-o",checkboxUnknown:"fa-square fancytree-helper-indeterminate-cb",dragHelper:"fa-arrow-right",dropMarker:"fa-long-arrow-right",error:"fa-warning",expanderClosed:"fa-caret-right",expanderLazy:"fa-angle-right",expanderOpen:"fa-caret-down",loading:{html:"<span class='fa fa-spinner fa-pulse' />"},nodata:"fa-meh-o",noExpander:"",radio:"fa-circle-thin",radioSelected:"fa-circle",doc:"fa-file-o",docOpen:"fa-file-o",folder:"fa-folder-o",folderOpen:"fa-folder-open-o"},awesome5:{_addClass:"",checkbox:"far fa-square",checkboxSelected:"far fa-check-square",checkboxUnknown:"fas fa-square fancytree-helper-indeterminate-cb",radio:"far fa-circle",radioSelected:"fas fa-circle",radioUnknown:"far fa-dot-circle",dragHelper:"fas fa-arrow-right",dropMarker:"fas fa-long-arrow-alt-right",error:"fas fa-exclamation-triangle",expanderClosed:"fas fa-caret-right",expanderLazy:"fas fa-angle-right",expanderOpen:"fas fa-caret-down",loading:"fas fa-spinner fa-pulse",nodata:"far fa-meh",noExpander:"",doc:"far fa-file",docOpen:"far fa-file",folder:"far fa-folder",folderOpen:"far fa-folder-open"},bootstrap3:{_addClass:"glyphicon",checkbox:"glyphicon-unchecked",checkboxSelected:"glyphicon-check",checkboxUnknown:"glyphicon-expand fancytree-helper-indeterminate-cb",dragHelper:"glyphicon-play",dropMarker:"glyphicon-arrow-right",error:"glyphicon-warning-sign",expanderClosed:"glyphicon-menu-right",expanderLazy:"glyphicon-menu-right",expanderOpen:"glyphicon-menu-down",loading:"glyphicon-refresh fancytree-helper-spin",nodata:"glyphicon-info-sign",noExpander:"",radio:"glyphicon-remove-circle",radioSelected:"glyphicon-ok-circle",doc:"glyphicon-file",docOpen:"glyphicon-file",folder:"glyphicon-folder-close",folderOpen:"glyphicon-folder-open"},material:{_addClass:"material-icons",checkbox:{text:"check_box_outline_blank"},checkboxSelected:{text:"check_box"},checkboxUnknown:{text:"indeterminate_check_box"},dragHelper:{text:"play_arrow"},dropMarker:{text:"arrow-forward"},error:{text:"warning"},expanderClosed:{text:"chevron_right"},expanderLazy:{text:"last_page"},expanderOpen:{text:"expand_more"},loading:{text:"autorenew",addClass:"fancytree-helper-spin"},nodata:{text:"info"},noExpander:{text:""},radio:{text:"radio_button_unchecked"},radioSelected:{text:"radio_button_checked"},doc:{text:"insert_drive_file"},docOpen:{text:"insert_drive_file"},folder:{text:"folder"},folderOpen:{text:"folder_open"}}};function l(e,t,n,i){var n=n.map,i=n[i],r=s(e),o=r.find(".fancytree-childcounter"),t=t+" "+(n._addClass||"");"string"==typeof i?(e.innerHTML="",r.attr("class",t+" "+i).append(o)):i&&(i.text?e.textContent=""+i.text:i.html?e.innerHTML=i.html:e.innerHTML="",r.attr("class",t+" "+(i.addClass||"")).append(o))}return s.ui.fancytree.registerExtension({name:"glyph",version:"2.33.0",options:{preset:null,map:{}},treeInit:function(e){var t=e.tree,e=e.options.glyph;e.preset?(a.assert(!!n[e.preset],"Invalid value for `options.glyph.preset`: "+e.preset),e.map=s.extend({},n[e.preset],e.map)):t.warn("ext-glyph: missing `preset` option."),this._superApply(arguments),t.$container.addClass("fancytree-ext-glyph")},nodeRenderStatus:function(e){var t,n,i=e.node,r=s(i.span),o=e.options.glyph,e=this._super(e);return!i.isRoot()&&((n=r.children("span.fancytree-expander").get(0))&&l(n,"fancytree-expander",o,i.expanded&&i.hasChildren()?"expanderOpen":i.isUndefined()?"expanderLazy":i.hasChildren()?"expanderClosed":"noExpander"),(n=(i.tr?s("td",i.tr).find("span.fancytree-checkbox"):r.children("span.fancytree-checkbox")).get(0))&&(t=a.evalOption("checkbox",i,i,o,!1),i.parent&&i.parent.radiogroup||"radio"===t?l(n,"fancytree-checkbox fancytree-radio",o,i.selected?"radioSelected":"radio"):l(n,"fancytree-checkbox",o,i.selected?"checkboxSelected":i.partsel?"checkboxUnknown":"checkbox")),n=r.children("span.fancytree-icon").get(0))&&l(n,"fancytree-icon",o,i.statusNodeType||(i.folder?i.expanded&&i.hasChildren()?"folderOpen":"folder":i.expanded?"docOpen":"doc")),e},nodeSetStatus:function(e,t,n,i){var r,o=e.options.glyph,e=e.node,a=this._superApply(arguments);return"error"!==t&&"loading"!==t&&"nodata"!==t||(e.parent?(r=s("span.fancytree-expander",e.span).get(0))&&l(r,"fancytree-expander",o,t):(r=s(".fancytree-statusnode-"+t,e[this.nodeContainerAttrName]).find("span.fancytree-icon").get(0))&&l(r,"fancytree-icon",o,t)),a}}),s.ui.fancytree});